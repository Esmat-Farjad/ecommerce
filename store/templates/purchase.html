{% extends 'main/base.html' %}
{% load static %}
{% block content %}

<div class="purchase-page">
    <div class="heading">
        <h1 class="title">Purchase Products</h1>
        <p class="text">Purchase the product to complete the stock</p>
    </div>
    <div class="purchase-holder">
        <form action="{% url 'store:purchase' %}" method="POST" class="p-10 inline" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-fields">
                <div class="product-info">
                    <label class="form-label">{{form.name.label_tag}}</label>
                    {{form.name}}
                    <label class="form-label">{{form.description.label_tag}}</label>
                    {{form.description}}
                    <label class="form-label">{{form.category.label_tag}}</label>
                    {{form.category}}
                </div>
                <div class="product-price">
                    <label class="form-label">{{form.quantity.label_tag}}</label>
                    {{form.quantity}}
                    <label class="form-label">{{form.price.label_tag}}</label>
                    {{form.price}}
                    <label class="form-label">{{form.bulk_price.label_tag}}</label>
                    {{form.bulk_price}}
                </div>
                <div class="extra-info">
                    <label class="form-label">{{form.mfd.label_tag}}</label>
                    {{form.mfd}}
                    <label class="form-label">{{form.expd.label_tag}}</label>
                    {{form.expd}}
                    <label class="form-label">{{form.stock.label_tag}}</label>
                    {{form.stock}}
                </div>
                <div class="option-info">
                    <label class="form-label">{{form.packet.label_tag}}</label>
                    {{form.packet}}
                    <label class="form-label">{{form.image.label_tag}}</label>
                    {{form.image}}
                </div>
            </div>
            
            <div class="purchase-button">
                <button type="submit" class="btn">Purchase</button>
            </div>
        </form>
    </div>
</div>

<hr>
<!-- PRODUCT DISPLAYING SECTION START -->
<div class="mx-10 mb-10 p-10">
<div class="heading">
    <h1 class="text-4xl text-center inline-block" id="border-design">Product Details</h1>
</div>
<table class="table-auto w-full">
    <thead class="w-full py-4 text-center bg-teal-500 shadow text-white ">
        <th class="py-4 " id="border-design">#</th>
        <th class="py-4 " id="border-design">Product Name</th>
        <th class="py-4 " id="border-design">Product Description</th>
        <th class="py-4 " id="border-design">Product Category</th>
        <th class="py-4 " id="border-design">Product Packet</th>
        <th class="py-4 " id="border-design">Product Rate</th>
        <th class="py-4 " id="border-design">Product Price</th>
        <th class="py-4" id="border-design">Product profit</th>
        <th class="py-4 " id="border-design">Product stock</th>
        <th class="py-4" id="border-design">Manufacturing Date</th>
        <th class="py-4" id="border-design">Expiration Date</th>
    </thead>
    <tbody class="text-center shadow border">
        
        {% for item in page_obj.object_list %}
        <tr class="border">
            {% if item.image %}
                <td class="py-3"><img src="{{item.image.url}}" alt="image" class="w-16 h-16 rounded-full shadow"></td>
            {% elif not item.image %}
                <td class="py-3"><img src="media/item_images/default.png" class="w-16 h-16 rounded-full shadow"></td>
            {% endif %}
            
            <td class="py-3">{{item.name}}</td>
            <td class="py-3 text-start w-40">{{item.description}}</td>
            <td class="py-3">{{item.category}}</td>
            <td class="py-3">{{item.packet}}</td>
            <td class="py-3">{{item.rate}}</td>
            <td class="py-3">{{item.price}}</td>
            <td class="py-3">{{item.profit}}</td>
            <td class="py-3">{{item.stock}}</td>
            <td class="py-3">{{item.mfd}}</td>
            <td class="py-3">{{item.expd}}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<!-- paginator navigation button start -->
<div class="flex justify-center my-5 py-3">
    {% if page_obj.has_previous %}
    <a href="?page={{page_obj.previous_page_number}}" class="relative tooltip">
        <i
            class="fa-solid fa-chevron-left rounded-full hover:text-white text-white px-2 py-1 bg-teal-500 hover:bg-teal-600 hover:shadow-md"></i>
        <small
            class="tooltip-text absolute top-0 right-10 rounded bg-teal-500 text-white px-3 shadow-lg">Previous</small>
    </a>
    {% else %}
    <i class="fa-solid fa-chevron-left rounded-full text-black px-2 py-1 bg-gray-300"></i>
    {% endif %}
    <span class="font-bold mx-10">Page
        <span class="bg-slate-300 text-dark rounded-full px-2 py-1">{{page_obj.number}}</span> of
        <span class="bg-slate-300 text-dark rounded-full px-2 py-1">{{page_obj.paginator.num_pages}}</span>
    </span>
    {% if page_obj.has_next %}
    <a href="?page={{page_obj.next_page_number}}" class="tooltip relative">
        <i
            class="fa-solid fa-chevron-right rounded-full hover:text-white text-white px-2 py-1 bg-teal-500 hover:bg-teal-600 shadow-md hover:shadow-lg"></i>
        <small class="tooltip-text absolute top-0 left-10 rounded bg-teal-500 text-white px-3 shadow-lg">Next</small>
    </a>
    {% else %}
    <i class="fa-solid fa-chevron-right rounded-full text-black px-2 py-1 bg-gray-300"></i>
    {% endif %}
</div>
<!-- paginator navigation button end -->
</div>
<script>
        const t = document.querySelector("#contentHandler");
            t.addEventListener("click", function () {
                var down = document.getElementById("down");
                var up = document.getElementById("up");
                if(! down.classList.contains("hidden")){
                    up.classList.remove("hidden");
                    down.classList.add("hidden");
                } else {
                    up.classList.add("hidden");
                    down.classList.remove("hidden");
                }
                $("#purchaseContainer").animate({
                    height: 'toggle'
                }, 1000);

            });

     /*CATEGORY CHECKING STARTS*/
    ele = document.getElementById("category");
    ele.addEventListener('change', function(e) {
        var a = e.target.value;
        if(a == 1 || a == 2){
            document.getElementById("mfd").style.display = "none";
            document.getElementById("expd").style.display = "none";
        }
    });
    /* CATEGORY CHECKING ENDS*/
    /* QUANTITY CALCULATION STARTS*/
   m = document.getElementById("num_packet");
   m.addEventListener("input", function(e) {
    var x = document.getElementById("packet_content").value;
    var num = e.target.value;
    var tq = x*num;
    document.getElementById('quantity').value =tq;
    document.getElementById("stock").value = tq;
   });
   pc = document.getElementById("packet_content");
    pc.addEventListener("input", function (e) {
        var x = document.getElementById("num_packet").value;
        var num = e.target.value;
        var tq = x * num;
        document.getElementById('quantity').value = tq;
        document.getElementById("stock").value = tq;
    });
   //QUANTITY CALCULATION ENDS

    element = document.getElementById('bprice');
    element.addEventListener('input', function (evt) {
        var package = document.getElementById('packet_content').value;
        if(package != "") {
            var b_price = evt.target.value;
            var r = b_price/package;
            document.getElementById('rate').value = Math.round(r);
        } else {
            document.getElementById('show_message').innerHTML = "Please provide the product quantity";
        }
    });
    element = document.getElementById("price");
    element.addEventListener('input', function(e) {
        var r = document.getElementById('rate').value;
            if(r != 0) {
            var p = e.target.value;
            var profit = p-r;
            document.getElementById('profit').value = profit;
            
        } else {
            document.getElementById("alert_message").innerHTML = "Please provide the product rate."
        }
    });

    elem = document.getElementById("quantity");
    elem.addEventListener("input", function(ev) {
        var qty = ev.target.value;
        document.getElementById('stock').value = qty;
        var b_price = document.getElementById('bprice').value;
        var r = b_price/qty;
        document.getElementById('rate').value = Math.round(r);   
       if(document.getElementById("show_message")) {
            document.getElementById("show_message").style.display = "none";
       }
       
       
    });
    if(document.getElementById('rate').value) {
        document.getElementById("alert_message").style.display = "none";
    }
    if(document.getElementById("quantity").value != '') {
        document.getElementById('alert_message').style.display = "none";
    }
</script>
{% endblock content %}